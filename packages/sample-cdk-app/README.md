# Bun AWS Lambda CDK Application

This project demonstrates how to create AWS Lambda functions using Bun runtime with the AWS CDK.

## Repository Structure

The repository is structured as follows:

```
packages/sample-cdk-app/
├── cdk.json
├── index.ts
├── package.json
├── README.md
├── stack/
│   ├── sample-cdk-app-stack.handler.ts
│   └── sample-cdk-app-stack.ts
├── test/
│   └── sample-cdk-app.test.ts
└── tsconfig.json
```

Key files:
- `index.ts`: The entry point for the CDK application.
- `stack/sample-cdk-app-stack.ts`: Defines the main CDK stack.
- `stack/sample-cdk-app-stack.handler.ts`: Contains the Lambda function handler code.
- `cdk.json`: CDK application configuration.

## Usage Instructions

### Prerequisites

- Bun (latest version)
- AWS account and credentials

### Installation

```
git clone <repository-url>
bun install
```

### Deploying the Stack

To deploy the stack to your AWS account:

1. Configure AWS credential [env vars](https://docs.aws.amazon.com/sdkref/latest/guide/environment-variables.html) or [config files](https://docs.aws.amazon.com/sdkref/latest/guide/file-format.html) 
1. Change to sample app folder:
   ```
   cd packages/sample-cdk-app
   ```
1. Set env vars for target account / region:
   ```
   export CDK_TARGET_ACCOUNT=<your-account-nr>
   export CDK_TARGET_REGION=<your-region-1>
   ```
1. Synthesize the CloudFormation template (optional):
   ```
   cdk synth
   ```
1. Deploy the stack:
   ```
   cdk deploy
   ```

### Configuration

The `cdk.json` file contains various configuration options for the CDK application. You can modify these settings to customize the behavior of your deployment.

It's mostly a copy of `cdk.json` generated by `npx cdk init --language=typescript`. Only the `app` entry has been changed to use bun instead of ts-node.

### Testing

To run the tests:

```
bun test
```

Note: The test file (`sample-cdk-app.test.ts`) currently contains a placeholder test. Uncomment and modify the test code as needed for your application.

## Infrastructure

The CDK stack (`SampleCdkAppStack`) creates the following resources:

- Lambda:
  - `handler-arm`: A Lambda function using ARM64 architecture
  - `handler-x86`: A Lambda function using x86 architecture

Both Lambda functions use the same handler code from `sample-cdk-app-stack.handler.ts`.

## Deployment

The `index.ts` file configures the CDK application for deployment. By default, it's set to deploy to the AWS account and region specified by environment variables `CDK_TARGET_ACCOUNT` and `CDK_TARGET_REGION`.
